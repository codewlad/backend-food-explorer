const knex = require("../database/knex");
const AppError = require("../utils/AppError");

class PaymentController {
    async index(req, res) {
        const { dishIds } = req.query;

        try {
            if (dishIds.length > 0) {
                const arrayDishIds = dishIds.split(",");

                const filteredDishes = await knex('dishes')
                    .select('id', 'image', 'name', 'price')
                    .whereIn('id', arrayDishIds);

                return res.json(filteredDishes);
            } else {
                return res.json({ Mensagem: "Não tem nenhum item adicionado ao pedido." });
            }
        } catch {
            throw new AppError("Não foi possível carregar o pedido.");
        }
    }
}

module.exports = PaymentController;